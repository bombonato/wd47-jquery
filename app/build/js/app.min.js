function salvaCartaoJquery(o){o.preventDefault();var a=$(".novoCartao-conteudo",this);console.log(a);var t=a.val().trim().replace(/\n/g,"<br>").replace(/(\*\*)(\w+)(\*\*)/g,function(o,a,t,n,e,r){return"<b>"+t+"</b>"}).replace(/(\*)(\w+)(\*)/g,function(o,a,t,n,e,r){return"<em>"+t+"</em>"});console.log("tam ("+t.length+")"),console.log(t),t&&(controladorCartoes.cria(t),principal.sincroEvent())}function sincronizaCartoes(){console.log("sincronizaCartoes()..."),$("#sync").removeClass("botaoSync--sincronizado"),$("#sync").addClass("botaoSync--esperando");var o=[];$(".cartao").each(function(){var a=$(this),t=a.find(".cartao-conteudo").html(),n=a.css("background-color");o.push({conteudo:t,cor:n}),console.log(o)});var a={usuario:principal.usuario,cartoes:o};$.ajax({url:"http://ceep.herokuapp.com/cartoes/salvar",method:"POST",data:a,dataType:"json",success:function(o){$("#sync").addClass("botaoSync--sincronizado"),console.log(o.quantidade+" cartoes salvos em "+o.usuario)},error:function(){$("#sync").addClass("botaoSync--deuRuim"),console.log("Nao foi possivel salvar o mural")},complete:function(){$("#sync").removeClass("botaoSync--esperando")}})}var principal=function(o){return{usuario:"john.doe@whoiam.io",sincroEvent:function(){o(document).trigger("sincronizaEvent")}}}(jQuery);$.fn.extend({animateCss:function(o){return this.addClass("animated "+o).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+o)}),this}}),document.querySelector("#mudaLayout").addEventListener("click",function(){var o=document.querySelector(".mural");o.classList.toggle("mural--linhas"),o.classList.contains("mural--linhas")?this.textContent="Blocos":this.textContent="Linhas"}),$(".novoCartao").submit(salvaCartaoJquery),$("#sync").click(function(){console.log("Botao sync"),principal.sincroEvent()}),$(document).one("sincronizaEvent",sincronizaCartoes),$("#ajuda").one("click",function(){$.getJSON("http://ceep.herokuapp.com/cartoes/instrucoes",function(o){console.log(o.instrucoes),$.each(o.instrucoes,function(){var o=this;console.log(o.conteudo),controladorCartoes.cria(o.conteudo,o.cor)})})}),$.getJSON("http://ceep.herokuapp.com/cartoes/carregar?callback=?",{usuario:principal.usuario},function(o){var a=o.cartoes;console.log(a.length+" carregados em "+o.usuario),a.forEach(function(o){controladorCartoes.cria(o.conteudo,o.cor)})}),$("#busca").on("input",function(){var o=$(this).val().trim();o.length?$(".cartao").hide().filter(function(){return $(this).find(".cartao-conteudo").text().match(new RegExp(o,"i"))}).show():$(".cartao").show()});var timer,controladorCartoes=function(o){"use strict";function a(){console.log("removeCartao()...");var o=this.dataset.idcartao,a=document.querySelector("#cartao"+o);a.classList.add("cartao--some"),setTimeout(function(){a.remove(),principal.sincroEvent()},170)}function t(o){console.log("decideTamanhoCartao()");var a=o.split("<br>").length;console.log("quebras: "+a);var t=o.replace(/<br>/g," ").length,n="";o.replace(/<br>/g," ").split(" ").forEach(function(o){o.length>n.length&&(n=o)},this);var e=n.length,r="cartao--textoPequeno";return e<9&&a<5&&t<55?r="cartao--textoGrande":e<12&&a<6&&t<75&&(r="cartao--textoMedio"),r}function n(a){var t=[{nome:"Padrão",codigo:"#EBEF40"},{nome:"Importante",codigo:"#F05450"},{nome:"Tarefa",codigo:"#92C4EC"},{nome:"Inspiração",codigo:"#76EF40"}],n=o("<div>").addClass("opcoesDoCartao-cores").attr("data-corref",a);return o.each(t,function(){var t=this,e="cor"+t.nome+"-"+a,r=o("<input>").addClass("opcoesDoCartao-radioCor").val(t.codigo).attr({type:"radio",id:e,name:"corDoCartao"+a}),c=o("<label>").addClass("opcoesDoCartao-opcao opcoesDoCartao-cor").text(t.nome).css("color",t.codigo).attr("for",e);n.append(r).append(c)}),n.on("change",function(a){if(console.log(),a.target.classList.contains("opcoesDoCartao-radioCor")){var t=o(a.target);console.log("data-: "+o(this).data("corref")),o("#"+o(this).data("corref")).css("background-color",t.val()),console.log("cor selecionada:"+t.val()),principal.sincroEvent()}}),n}return{cria:function(e,r){var c=o(".cartao").length;c++;var s=o("<p>").addClass("cartao-conteudo").attr("contenteditable",!0).html(e).on("input",function(){clearTimeout(timer),timer=setTimeout(function(){o(document).trigger("sincronizaEvent")},1e3)});console.log(s);var i=o("<button>").addClass("opcoesDoCartao-opcao opcoesDoCartao-remove").text("Remove").click(a).attr("data-idcartao",c),l=n("cartao"+c),u=o("<div>").addClass("opcoesDoCartao").append(i).append(l),d=t(e);console.log("classe tam cartao: "+d);var p=o("<div>").addClass("cartao").addClass(d).append(u).append(s).attr("id","cartao"+c).css("background-color",r);console.log(p),o(".mural").prepend(p),p.animateCss("bounce")}}}(jQuery);